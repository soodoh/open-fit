generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]

  role     Role
  password String

  Routine                 Routine[]
  defaultRepetitionUnit   RepetitionUnit @relation(fields: [defaultRepetitionUnitId], references: [id])
  defaultRepetitionUnitId Int            @default(1)
  defaultWeightUnit       WeightUnit     @relation(fields: [defaultWeightUnitId], references: [id])
  defaultWeightUnitId     Int            @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

model Routine {
  id          Int          @id @default(autoincrement())
  user        User         @relation(fields: [userId], references: [id])
  userId      String
  name        String
  description String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  routineDays RoutineDay[]
}

enum Weekday {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model RoutineDay {
  id          Int               @id @default(autoincrement())
  routine     Routine           @relation(fields: [routineId], references: [id])
  routineId   Int
  weekdays    Weekday[]
  description String
  setGroups   WorkoutSetGroup[]
}

enum SetGroupType {
  NORMAL
  SUPERSET
  DROPSET
  MYO
}

model WorkoutSetGroup {
  id           Int          @id @default(autoincrement())
  routineDay   RoutineDay   @relation(fields: [routineDayId], references: [id])
  routineDayId Int
  sets         WorkoutSet[]
  type         SetGroupType @default(NORMAL)
  order        Int
  comment      String?

  @@unique([routineDayId, order])
  @@index([routineDayId])
}

model WorkoutSet {
  id               Int             @id @default(autoincrement())
  setGroup         WorkoutSetGroup @relation(fields: [setGroupId], references: [id])
  setGroupId       Int
  exercise         Exercise        @relation(fields: [exerciseId], references: [id])
  exerciseId       Int
  reps             Int
  repetitionUnit   RepetitionUnit  @relation(fields: [repetitionUnitId], references: [id])
  repetitionUnitId Int
  weight           Float           @default(0)
  weightUnit       WeightUnit      @relation(fields: [weightUnitId], references: [id])
  weightUnitId     Int
  order            Int

  @@unique([setGroupId, order])
  @@index([setGroupId])
}

enum ExerciseForce {
  push
  pull
  static
}

enum ExerciseLevel {
  beginner
  intermediate
  expert
}

enum MuscleGroup {
  abdominals
  chest
  quadriceps
  hamstrings
  glutes
  adductors
  abductors
  calves
  forearms
  shoulders
  biceps
  triceps
  traps
  lats
  middle_back
  lower_back
  neck
}

enum ExerciseCategory {
  strength
  cardio
  stretching
  plyometrics
  powerlifting
  strongman
  olympic_weightlifting
}

enum ExerciseMechanic {
  compound
  isolation
}

enum Equipment {
  body_only
  machine
  cable
  foam_roll
  dumbbell
  barbell
  ez_curl_bar
  kettlebells
  medicine_ball
  exercise_ball
  bands
  other
}

model Exercise {
  id               Int               @id @default(autoincrement())
  name             String            @unique
  equipment        Equipment?
  force            ExerciseForce?
  level            ExerciseLevel
  mechanic         ExerciseMechanic?
  primaryMuscles   MuscleGroup[]
  secondaryMuscles MuscleGroup[]
  instructions     String[]
  category         ExerciseCategory
  images           String[]
  workoutSets      WorkoutSet[]
}

model RepetitionUnit {
  id    Int          @id @default(autoincrement())
  name  String       @unique
  sets  WorkoutSet[]
  users User[]
}

model WeightUnit {
  id    Int          @id @default(autoincrement())
  name  String       @unique
  sets  WorkoutSet[]
  users User[]
}
