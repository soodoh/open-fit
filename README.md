# Open Fit

A fitness tracking application built with Next.js and Convex.

## Getting Started

### Prerequisites

- [Node.js](https://nodejs.org/) 18+
- [pnpm](https://pnpm.io/) package manager
- A [Convex](https://convex.dev/) account (free tier available)

### 1. Clone and Install Dependencies

```bash
git clone https://github.com/your-username/open-fit.git
cd open-fit
pnpm install
```

### 2. Create your .env.local

```env
NEXT_PUBLIC_CONVEX_URL='http://localhost:3210'
CONVEX_SELF_HOSTED_URL='http://localhost:3210'
INSTANCE_NAME='convex-self-hosted'
INSTANCE_SECRET='...' # Generated by `openssl rand -hex 32`
CONVEX_SELF_HOSTED_ADMIN_KEY='...' # Will update this in a later section
```

### 3. Set Up Convex

Spin up a local docker instance for Convex backend & dashboard. The `compose.yml` file included in this repo should take care of everything for you.

```bash
docker compose up -d
```

### 4. Update CONVEX_SELF_HOSTED_ADMIN_KEY

Once the docker containers are running, obtain the admin key generated from within the Convex backend container. FYI the name of your container is probably `open-fit-convex-backend-1`, but you can verify this by checking `docker ps`.

```bash
docker exec -it open-fit-convex-backend-1 bash
```

Then run the following inside the container shell.

```bash
./generate_admin_key.sh
```

Paste the output in your `.env.local` as the value for `CONVEX_SELF_HOSTED_ADMIN_KEY`.

Note:
Running `./generate_admin_key.sh` will return a new key every time. But as long as the `INSTANCE_SECRET` env variable is consistent, any admin keys generated in the future will still work.

### 5. Deploy schema & functions to Convex container

Now that the containers are running & .env.local is updated accordingly, run the following.

```bash
npx convex deploy
```

### 6. Generate JWT keys for auth & apply to Convex function environment variables

Convex auth requires `JWT_PRIVATE_KEY` and `JWKS` to be in the environment for Convex functions. Unfortunately, this is a different environment than the Convex backend container itself, so it cannot be simply included in the `.env.local` (for now).

```bash
node ./scripts/generateKeys.mjs

# Paste the corresponding output here
npx convex env set -- JWT_PRIVATE_KEY "paste from previous command"
npx convex env set -- JWKS "paste from previous command"
```

### 7. Seed the Database

Seed the database with exercises and units:

```bash
pnpm convex run seed:run
```

This creates:
- 400+ exercises with muscle groups, equipment, and instructions
- Repetition units (Repetitions, Seconds, Minutes, Miles, Kilometers)
- Weight units (lb, kg, Body Weight)

### 8. Run the Development Server

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) and create an account to get started.

### 9. (Optional) Seed Mock Data for Testing

After creating an account, you can seed test data (50 routines with days and sets):

```bash
pnpm convex run seed:mockUserData '{"email": "your@email.com"}'
```

Replace `your@email.com` with the email you registered with.

## Project Structure

```
├── app/                    # Next.js app router pages
├── components/             # React components
│   ├── auth/              # Authentication components
│   ├── exercises/         # Exercise-related components
│   ├── routines/          # Routine management components
│   ├── sessions/          # Workout session components
│   ├── ui/                # Shared UI components
│   └── workoutSet/        # Workout set components
├── convex/                 # Convex backend
│   ├── mutations/         # Data mutation functions
│   ├── queries/           # Data query functions
│   ├── schema.ts          # Database schema
│   └── seed.ts            # Database seeding
├── lib/                    # Utility functions and types
└── public/                 # Static assets
```

## Tech Stack

- **Frontend**: Next.js 16, React 19, TypeScript
- **Backend**: Convex (real-time database and serverless functions)
- **Authentication**: Convex Auth with email/password
- **Styling**: Tailwind CSS, shadcn/ui components
- **Drag & Drop**: dnd-kit

---

# Roadmap

## TODO

- Bugs
    - Updating exercise filter with empty search not showing number of exercises found

- Fix WorkoutList improvements
    - SetRow
        - Add option to delete set (swipe left on mobile?)
        - Better drag reorder handler (should work on the whole row)
    - SetGroup
        - Adding a set to a completed workout should automatically be marked as completed
        - Should be able to drag the whole row
        - Remove reorder mode, just work?
        - Add "info" button that opens ExerciseDetail modal

- Update Logs search to filter by date (greater than or less than), or exercises used in the session

- Ability to favorite routines?

- Fix nested button warning when enabling "reorder" mode for set groups in WorkoutList

- Update Routines page design
    - Does not show routine days in the card
    - Clicking the card opens a modal allowing you to view/start a workout from the day selected
    - Remove dropdown from routine card, instead show edit/delete buttons
    - Remove day page route, instead clicking an edit button in the routine card opens a modal
    - The edit modal should have multiple tabs: Routine info, tab for each day
        - Button at the bottom to add a new day
    - In edit routine day section, provide same UI as the routine day page, but also allow for editing day of the week
        - Button for deleting the day

- Convex to handle image uploads
    - Update seedDatabase script to upload exercise images to Convex
    - Consume Convex stored images with next/image

- Admin view/route
    - Manage exercises
    - Only allow deleting if not used by any records
    - Handle image uploading/deleting for exercises
    - Manage global values: muscle group, category, equipment, rep units, weight units
    - Manage users: update their user role and other profile settings

- Add "isPublic" property to routines that only admins can set. These routines will be seen by all users.
    - Ensure that non-public routines are only shown to the user that created it.

- Add "gyms"
    - Users can create their own gyms (in profile settings). It should have a name and a list of equipment.
    - Autocomplete equipment selection when adding to gyms.
    - In profile settings, user can choose which gyms they are affiliated with
    - In day/session page & active session views, searching should exercises should only show if selected gym has equipment for that exercise.

- Add seed script for common, real workouts
    - Weight lifting: 2,3,4,5 day splits
    - Circuit training?
    - Cardio?
    - HAL-like marathon training routine
    - Stretching routine
        - Add missing stretches if needed, should match my old stretching routine

- Home Page
    - Show workout in progress (if there is one)
    - Show recently used routines
    - Show next routine day from last used routine?
    - Show popular routines?
    - Show PRs, progress graphs

- Logs page
    - Section for PRs
    - Section to view visualizations on progress (choose a exercise with history)
    - Calendar history of workouts logged (like github activity view?)

- Replace with similar exercise option (button on the SetGroup)
    - Allow to replace with *any* exercise, but have a toggle that filters to "recommended" exercises
    - Warn that it modifies existing sets in that group?

## Planned

- [ ] Dev experience
    - [ ] GitHub Actions w/ changeset flow
    - [ ] Documentation website
- [ ] PWA
    - [ ] Add manifest, icons, metadata
    - [ ] Use service workers
    - [ ] Offline support & syncing
- [ ] Workout page
    - [ ] Suggest alternate exercises based on muscle group
    - [ ] Filter exercises based on available equipment
- [ ] User Profile page
    - [ ] Create gyms, assign available equipment
- [ ] Exercises page
    - [ ] Users can add custom exercises
    - [ ] Users can upload images for exercises
- [ ] Metrics view per exercise
    - [ ] View graphs of historical exercises
    - [ ] Calculate 1 rep max & other metrics
- [ ] Globalization / localization

## Someday

- [ ] Playwright testing for UI flows
- [ ] Nutrition planning feature
- [ ] PWA wrapper or React Native app for iOS/Android with Apple Health/Health Connect integration
